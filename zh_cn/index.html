<!DOCTYPE html>
<html lang="zh_cn">
<head>
<meta charset="utf-8">
<meta name="description" content="Intellegence Evolution">
<meta name="viewport" content="width=device-width">
<title>Intellegence Evolution | Intellegence Evolution</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (zh_cn)" href="rss.xml">
<link rel="canonical" href="https://monkeyxite.github.io/zh_cn/">
<link rel="next" href="index-10.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">跳到主内容</a>

<!-- Menubar -->

<div class="navbar navbar-static-top" id="navbar">
    <div class="navbar-inner">
        <div class="container">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>

            <a class="brand" href="https://monkeyxite.github.io/zh_cn/">

                <span id="blog-title">Intellegence Evolution</span>
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav">
<li>
<a href="archive.html">文章归档</a>
                </li>
<li>
<a href="categories/">标签</a>
                </li>
<li>
<a href="rss.xml">RSS 源</a>

                    
                </li>
</ul>
<ul class="nav pull-right">
<li>            </li>
<li><a href="https://monkeyxite.github.io/" rel="alternate" hreflang="en">English</a></li>

                    <li>
                
                </ul>
</div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="content" role="main">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
    
    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/vim-cheatsheet/" class="u-url">vim cheatsheet</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/vim-cheatsheet/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-28T22:42:01+08:00" itemprop="datePublished" title="2018-10-28 22:42">2018-10-28 22:42</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Write your post here.</p>
<h4>Insert mode commands</h4>
<ul>
<li>Switch from Insert to Normal mode for one command only: <code>CTRL-o</code> (followed by the normal mode command)</li>
<li>Delete back to the beginning of the previous word (or the beginning of the current word if the cursor is already inside a word): <code>CTRL-w</code>
</li>
<li>Indent current line: <code>CTRL-t</code> (mnemonic: "tab")</li>
<li>Dedent current line: <code>CTRL-d</code> (mnemonic: "dedent")</li>
<li>Insert a hard tab, even when it would normally be expanded to spaces: <code>CTRL-V &lt;tab&gt;</code>
</li>
<li>Insert current filename <code>CTRL-r %</code> (for related things that can be inserted with <code>CTRL-r</code>, see <code>:h i_CTRL-R</code>).</li>
</ul>
<h4>Normal mode commands</h4>
<ul>
<li>
<code>==</code>: intelligently indent selection (or currently line if no selection); <em>note that what is actually happening here is that we’re using the "filter" functionality with no filter, so <a href="../wiki/Vim">Vim</a> just uses the standard builtin "C indenting" functionality</em> (for more information see <code>:h filter</code>)</li>
<li>
<code>gq{motion}</code>: reformat (rewrap); eg:<ul>
<li>
<code>gqq</code>: reformat (rewrap) current line</li>
</ul>
</li>
<li>
<code>gu{motion}</code>: lowercase</li>
<li>
<code>gU{motion}</code>: uppercase</li>
<li>
<code>g~{motion}</code>: toggle case</li>
<li>
<code>CTRL-x</code>: increment the number at (the end of) the word under the cursor</li>
<li>
<code>CTRL-a</code>: decrement the number at (the end of) the word under the cursor</li>
<li>
<code>gv</code>: reselect last selection</li>
<li>
<code>g CTRL-G</code>: show current cursor position and total counts (columns, lines, words, bytes)</li>
<li>
<code>ga</code>: show ASCII info for character under cursor</li>
<li>
<code>g8</code>: show UTF-8 info for character under cursor</li>
<li>
<code>CTRL-w f</code>: open the file under the cursor in a split (<code>gf</code> will do this without the split)</li>
</ul>
<h5>Window and tab-related commands</h5>
<ul>
<li>
<code>CTRL-w =</code>: resize windows to be equal width and height</li>
<li>
<code>CTRL-W r</code> or <code>CTRL-W CTRL-R</code>: Rotate windows (downwards/rightwards)</li>
<li>
<code>CTRL-W {H,J,K,L}</code>: Move a window to occupy to an entire edge of the viewport; eg. <code>CTRL-W J</code> pushes the current window to the bottom, occupying the full width (also works: <code>CTRL-W CTRL-{H,J,K,L}</code>)</li>
<li>
<code>CTRL-W T</code>: open current window in a new tab</li>
<li>
<code>CTRL-W _</code>: make current window as big as possible (cf. <code>10 CTRL-W _</code>, which makes it 10 lines high); (also works: <code>CTRL-W CTRL-_</code>)</li>
<li>
<code>CTRL-W b</code>: move to bottom window (also works: <code>CTRL-W CTRL-B</code>)</li>
<li>
<code>CTRL-W t</code>: move to top window (also works: <code>CTRL-W CTRL-T</code>)</li>
<li>
<code>gt</code>: next tab</li>
<li>
<code>gT</code>: previous tab</li>
</ul>
<p>For more see <code>:h window-moving</code></p>
<h5>Movement</h5>
<p>For lots of documentation see <code>:h motion.txt</code>.</p>
<ul>
<li>
<code>h</code>, <code>j</code>, <code>k</code>, <code>l</code>: per-character/per-line movement through file (left, down, up, right)</li>
<li>
<code>gj</code>, <code>gk</code>: per-line movement through buffer, operating on <em>display lines</em> (which may be wrapped) not actual lines in the file (down, up)</li>
<li>
<code>w</code>: forward a word (mnemonic: "word"); here "word" is an "keyword" (identifier) like "foo9" or "h_go" and the movement is to the <em>beginning</em> of the next word</li>
<li>
<code>W</code>: forward a "big" word; here a "word" is <em>anything</em> other than whitespace</li>
<li>
<code>b</code>: back a word (mnemonic: "back"); again the movement is to the <em>beginning</em> of the word</li>
<li>
<code>B</code>: back a "big" word</li>
<li>
<code>e</code>: forward to the <em>end</em> of a word (mnemonic: "end")</li>
<li>
<code>E</code>: forward to the <em>end</em> of a "big" word</li>
<li>
<code>ge</code>: back to the <em>end</em> of the last word</li>
<li>
<code>gE</code>: back to the <em>end</em> of the last "big" word</li>
<li>
<code>f{character}</code>: forward to the next occurrence of <code>character</code> (mnemonic: "find/foward")</li>
<li>
<code>F{character}</code>: same as <code>f{character}</code>, but search in the opposite direction</li>
<li>
<code>t{character}</code>: forward <em>til</em> (until) the next occurrence of <code>character</code> (mnemonic: "til/to"); the cursor is place immediately <em>before</em> and not on the character</li>
<li>
<code>T{character}</code>: same as <code>t{character}</code>, but search in the opposite direction</li>
<li>
<code>;</code>: repeat last <code>f</code>, <code>F</code>, <code>t</code> or <code>T</code> operation</li>
<li>
<code>,</code>: repeat last <code>f</code>, <code>F</code>, <code>t</code> or <code>T</code> operation, but in the opposite direction</li>
<li>
<code>CTRL-F</code>: forward a (full) screen (mnemonic: "forward")</li>
<li>
<code>CTRL-B</code>: back a (full) screen (mnemonic: "back")</li>
<li>
<code>CTRL-D</code>: down a (half) screen (mnemonic: "down")</li>
<li>
<code>CTRL-U</code>: up a (half) screen (mnemonic: "up")</li>
<li>
<code>H</code>: jump to top of screen (mnemonic: "high")</li>
<li>
<code>M</code>: jump to middle of screen (mnemonic: "middle")</li>
<li>
<code>L</code>: jump to bottom of screen (mnemonic: "low")</li>
<li>
<code>gg</code>: jump to top of file (mnemonic: like <code>more</code> or <code>less</code> pagers, except plain <code>g</code> isn’t available so we have to use <code>gg</code>)</li>
<li>
<code>G</code>: jump to bottom of file (mnemonic: like <code>more</code> or <code>less</code> pagers)</li>
<li>
<code>200G</code>: jump to line 200</li>
<li>
<code>:200</code>: same as <code>200G</code>
</li>
<li>
<code>{</code>: jump to last blank line</li>
<li>
<code>}</code>: jump to next blank line</li>
<li>
<code>[[</code>: jump to previous <code>{</code> in column 0</li>
<li>
<code>]]</code>: jump to next <code>{</code> in column 0</li>
<li>
<code>][</code>: jump to next <code>}</code> in column 0</li>
<li>
<code>[]</code>: jump to previous <code>}</code> in column 0</li>
<li>
<code>%</code>: jump to matching brace (with <a href="http://www.vim.org/scripts/script.php?script_id=39">matchit.vim</a> you can also jump to matching HTML tags and the like)</li>
<li>
<code>]s</code>: jump to next misspelled word</li>
<li>
<code>zg</code>: mark a word as good, adding it to the spelling dictionary</li>
</ul>
<h5>Scrolling</h5>
<ul>
<li>
<code>zz</code> center current cursor line within viewport</li>
<li>
<code>zt</code> scroll current cursor line to top of viewport</li>
<li>
<code>zb</code> scroll current cursor line to bottom of viewport</li>
<li>
<code>CTRL-y</code> scroll down a line</li>
<li>
<code>CTRL-e</code> scroll up a line</li>
<li>
<code>CTRL-d</code> scroll down one page</li>
<li>
<code>CTRL-u</code> scroll up one page</li>
</ul>
<h5>Marks and jumps</h5>
<p>When jumping to a mark, there are two variants:</p>
<ul>
<li>with <code>'</code>, the jump is line-wise, to the first non-blank character on the line containing the mark</li>
<li>with ```, the jump is character-wise, to the position of the mark within the line</li>
</ul>
<p>Example commands:</p>
<ul>
<li>
<code>m{letter}</code>: create a mark at the current position</li>
<li>
<code>'{letter}</code>: jump to specified mark (first non-whitespace character on line)</li>
<li>
<code>`{letter}</code>: jump to specified mark (to column where mark was set)</li>
<li>
<code>''</code>: jump back to the last line jumped from</li>
<li>````: jump back to the last position jumped from</li>
<li>
<code>`.</code>: jump to position where last change occurred in current buffer</li>
<li>
<code>[` and</code>]`: jump to beginning/end of last changed or yanked text</li>
<li>
<code>&lt;` and</code>&gt;`: jump to beginning/end of last visual selection</li>
<li>
<code>:jump</code>: show the jump list (places you’ve jumped to with motion commands, specifically those listed at <code>:h jump-motions</code>)</li>
<li>
<code>CTRL-o</code>: move to older position in jump list (mnemonic: "jump out")</li>
<li>
<code>CTRL-i</code>: move to newer position in jump list (mnemonic: "jump in")</li>
<li>
<code>:changes</code>: show the changes list for the current buffer (places you’ve edited)</li>
<li>
<code>g;</code>: move to older position in change list</li>
<li>
<code>g,</code>: move to newer position in change list</li>
</ul>
<h5>Search</h5>
<ul>
<li>
<code>*</code>: find word under cursor</li>
<li>
<code>#</code>: find word under cursor (reverse direction)</li>
<li>
<code>g*</code>: like <code>*</code>, but also looks for matches which are substrings of other words</li>
<li>
<code>g#</code>: like <code>#</code>, but also looks for matches which are substrings of other words</li>
<li>
<code>/{pattern}</code>: find pattern (mnemonic: like <a href="../wiki/Perl">Perl</a>/<a href="../wiki/Ruby">Ruby</a>/pager etc regex syntax)</li>
<li>
<code>?{pattern}</code>: find pattern (reverse direction)</li>
<li>
<code>n</code>: repeat last search</li>
<li>
<code>N</code>: repeat last search in opposite direction</li>
<li>
<code>gn</code>: go to next match and select it visually; can be used as a motion as well (ie. <code>cgn</code> means "change next match")</li>
<li>
<code>ggn</code>: go to first match in file</li>
<li>
<code>Gn</code>: go to last match in file</li>
</ul>
<h5>Folding</h5>
<ul>
<li>
<code>zr</code>: decrement <code>'foldlevel'</code> A.K.A. "fold less" (mnemonic: reduce)</li>
<li>
<code>zm</code>: increment <code>'foldlevel'</code> A.K.A. "fold more" (mnemonic: more)</li>
<li>
<code>zR</code>: decrement <code>'foldlevel'</code> to zero A.K.A. "unfold everything" (mnemonic: <em>reduce</em>)</li>
<li>
<code>zM</code>: increment <code>'foldlevel'</code> to maximum A.K.A&gt; "fold everything" (mnemonic: <em>more</em>)</li>
<li>
<code>zo</code>: open current fold</li>
<li>
<code>zO</code>: open current fold recursively</li>
<li>
<code>zc</code>: close current fold</li>
<li>
<code>zC</code>: close current fold recursively</li>
<li>
<code>zv</code>: view cursor line A.K.A. "open just enough folds to make cursor line visible" (mnemonic: <em>view</em>/<em>visible</em>)</li>
<li>
<code>zi</code>: toggle value of <code>'foldenable'</code> (mnemonic: invert)</li>
</ul>
<h4>Visual mode commands</h4>
<p>Enter using <code>V</code>:</p>
<ul>
<li>
<code>gq</code>: reformat (rewrap) selection</li>
<li>
<code>o</code>: jump to opposite end of selection</li>
</ul>
<h4>Visual (block) mode commands</h4>
<p>Enter using <code>&lt;C-v&gt;</code>:</p>
<ul>
<li>
<code>$A{string}&lt;Esc&gt;</code>: append to each line, varying lengths (<a href="http://vimdoc.sourceforge.net/htmldoc/visual.html#v_b_A">details</a>).</li>
</ul>
<h4>Command mode commands</h4>
<ul>
<li>
<code>:nohlsearch</code> (<code>:noh</code>): remove currently visible search highlighting (doesn’t disable highlighting permanently)</li>
<li>
<code>:enew</code> (<code>:ene</code>): open a new scratch buffer</li>
<li>
<code>:write</code>: write current buffer to a file</li>
<li>
<code>:read</code>: read into current buffer; eg:</li>
<li>
<code>:read !{shell command}</code>: insert output of shell command into current buffer at current cursor location</li>
<li>
<code>:{range}d</code>: delete lines in <code>{range}</code>
</li>
<li>
<code>:{range}y</code>: yank lines in <code>{range}</code>
</li>
<li>
<code>:g/{pattern}/{action}</code>: perform action on lines matching pattern (eg. <code>:g/a/d</code> would delete all lines matching "a")</li>
<li>
<code>:v/{pattern}/{action}</code>: inverse of <code>:g</code> (performs action on non-matching lines)</li>
</ul>
<p>To open the command-line window (showing full command history in a buffer, which you can edit, then use <code>&lt;CR&gt;</code> to run a given line’s command):</p>
<ul>
<li>
<code>q:</code>: for commands</li>
<li>
<code>q/</code>: for searches (or <code>q?</code>)</li>
</ul>
<p>Funnily, you can easily open this by mistake by typing <code>q:</code> when you mean to type the quite-frequently-used <code>:q</code> instead.</p>
<h5>Quickfix/Location list</h5>
<h6>Commands</h6>
<ul>
<li>
<code>:cclose</code> (<code>:ccl</code>): close quickfix window (<code>:lclose</code> and <code>:lcl</code> for location list)</li>
<li>
<code>:colder</code> (<code>:col</code>): show previous quickfix results (<code>:lolder</code> and <code>:lol</code> for location list)</li>
<li>
<code>:cnewer</code> (<code>:cnew</code>): show subsequent quickfix results (<code>:lnewer</code> and <code>:lnew</code> for location list)</li>
</ul>
<h6>Mappings</h6>
<ul>
<li>
<code>CTRL-w Enter</code>: open current item in a split.</li>
</ul>
<h5>Mappings available in command mode</h5>
<ul>
<li>
<code>&lt;C-r&gt;{register}</code>: paste the text from the specified register into the command line (eg. to paste the last-yanked text, do <code>&lt;C-r&gt;"</code>)</li>
<li>
<code>&lt;C-r&gt; w</code>: paste word currently under cursor</li>
</ul>
<h4>Special mappings</h4>
<ul>
<li>
<code>&lt;C-w&gt; &lt;CR&gt;</code>: open quickfix entry in a horizontal split</li>
</ul>
<h3>Spacevim special</h3>
<h4>extra pluggin</h4>
<ul>
<li>
<code>&lt;SPC&gt; D d</code>: search word under current docset</li>
<li>
<code>&lt;SPC&gt; D D</code>: search word under all docsets</li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/tool-chain-for-email-handling/" class="u-url">tool chain for email handling</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/tool-chain-for-email-handling/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-27T21:15:57+08:00" itemprop="datePublished" title="2018-10-27 21:15">2018-10-27 21:15</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<h2>Background</h2>
<p>Using email everyday, so the efficiency to handle email defines the efficiency of your day.</p>
<h2>Email handling principle</h2>
<ol>
<li>Limit the access or notification of email, but pull the update with specific timeslot per day.</li>
<li>Get rid of redundancies like HTML email, but pure text (or markdown into html automatically if needed)</li>
<li>Filtering, Labeling and "Zero Inbox" is key for email handling</li>
</ol>
<h2>Tool Chain for email</h2>
<p>After searching for years, these tools are choosen for efficient email handling:</p>
<p>Email Client: Neomutt together with mbsync, msmtp; 
Filtering: marina or mu;
Editor: vim with muttdown;
Calendar: ? TBD with one terminal tool, 
Contact: abook with khard? ;
Misc: urlscan, w3m, gpgme, etc; </p>
<h2>Working flow and procedure</h2>
<h3>Config Email</h3>
<p>TBD, suggest follow dotfile procedure.</p>
<h3>Recieving Email</h3>
<p>Taking your specific time slot for email, than just open terminal and:</p>
<pre class="code literal-block"><span></span>mbsync -a 
</pre>


<h3>Sorting/Labeling Email</h3>
<h3>Write Email</h3>
<p>Vim would be the major working force for this task with fancy tools included such as auto complete and spell checking.</p>
<h4>Raw Text</h4>
<p>Normal working follow editing txt file in vim. 
TBD for special plugin to handle email more efficiently.</p>
<h4>Rich Format</h4>
<p>Add muttdown for sending out rich format by using muttdown.</p>
<h4>Spellcheck: vim</h4>
<p>To move to a misspelled word, use <strong>]s</strong> and <strong>[s</strong>. 
<strong>z=</strong>, and Vim will suggest a list of alternatives that it thinks may be correct.
<strong>zg</strong> command and Vim will add it to its dictionary.
You can also mark words as incorrect using <strong>zw</strong>.</p>
<pre class="code literal-block"><span></span>;enable <span class="k">spell</span>
<span class="k">set</span> <span class="nb">nospell</span>
;disable <span class="k">spell</span>
<span class="k">set</span> <span class="k">spell</span>
;change default <span class="k">lang</span>
<span class="k">set</span> <span class="k">spell</span> <span class="nb">spelllang</span><span class="p">=</span>en_us
</pre>


<h3>Calendar handling</h3>
<h3>Contact</h3>
<p>Abook auto complete integration
How to sync with cloud.</p>
<h2>Reference</h2>
<ul>
<li><a href="https://www.linux.com/learn/using-spell-checking-vim">hwo to spell check within vim</a></li>
<li><a href="https://github.com/Roguelazer/muttdown">muttdown</a></li>
<li><a href="https://webgefrickel.de/blog/a-modern-mutt-setup">a modern setup of mutt</a></li>
<li><a href="http://blog.iodoru.org/post/2017-07-18-mu/">why mu</a></li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-data-visulaization-by-jupyter-and-superset/" class="u-url">python data visulaization by jupyter and superset</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/python-data-visulaization-by-jupyter-and-superset/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-23T21:29:18+08:00" itemprop="datePublished" title="2018-10-23 21:29">2018-10-23 21:29</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>There are plenties of ways to make your data vivid via data visualization.</p>
<p>And python have tools like superset to make the visual report much more easier. And jupyter is a handy tool together with matplotlib and seaborn to try the data lab.</p>
<h2>jupyter</h2>
<p>For typical jupyter, the intension might not be used as a tool to visualization but a warehouse to tuning, manipulate and sharp the date before reporting. It need several component to make the report more suitable for reporting, such as :</p>
<ul>
<li>
<a href="https://github.com/damianavila/RISE">RICE</a>.</li>
<li><a href="https://matplotlib.org/">matplotlib</a></li>
<li><a href="https://seaborn.pydata.org/">Seaborn</a></li>
</ul>
<p>And further digging for seaborn &amp; matplotlib would be continously updated later on.</p>
<h2>Superset</h2>
<p>The end to end interface for BI as what tableau provided. While, there is pros and cons compared with tableau but for sure the opensource and community eco system is one of the attraictions for non-enterprise users and amateur users. </p>
<p>TBC for usage/configuration of Superset.</p>
<h2>Reference</h2>
<ol>
<li>https://superset.incubator.apache.org/</li>
<li>https://www.pervasivecomputing.net/data-analytics/superset-vs-tableau</li>
<li>https://medium.com/airbnb-engineering/caravel-airbnb-s-data-exploration-platform-15a72aa610e5</li>
<li>https://medium.com/airbnb-engineering/superset-scaling-data-access-and-visual-insights-at-airbnb-3ce3e9b88a7f</li>
<li>https://www.xpand-it.com/2018/09/17/apache-superset-open-source-bi/</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/way-to-debug-vim/" class="u-url">way to debug vim</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/way-to-debug-vim/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-21T21:50:28+08:00" itemprop="datePublished" title="2018-10-21 21:50">2018-10-21 21:50</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Find the right issue submit info, might be some info for getting verbose of runtime debug. Such as <a href="https://github.com/SpaceVim/SpaceVim/issues">SpaceVim Issue Tracker</a> or <a href="https://github.com/davidhalter/jedi-vim/issues">vim-jedi issue tracker</a>, providing detailed guide for stepwise debugging info</p>
<h3>Dis functional shortcut key</h3>
<p>Typical scenario would be triggered some error or unexpected behavior after press some key. Then it's essential to get the details by identify what happened firstly after certain key pressed (or what vim thought should be happened)</p>
<pre class="code literal-block"><span></span><span class="p">:</span><span class="k">verb</span> map K?
</pre>


<h3>Python Plugin</h3>
<p>For python plugin, try to find python env issue inside of vim</p>
<pre class="code literal-block"><span></span><span class="p">:</span><span class="n">python</span> <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span> <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">jedi</span>
</pre>


<h3>To Be Continue</h3>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nikola-auto-deployment-in-github-pages-with-custom-domain-name-cname/" class="u-url">nikola auto deployment in github pages with custom domain name (CNAME)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/nikola-auto-deployment-in-github-pages-with-custom-domain-name-cname/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-18T22:10:45+08:00" itemprop="datePublished" title="2018-10-18 22:10">2018-10-18 22:10</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>While github pages is applicable to using the custom domain name accordingly, which acutally creating a CNAME file with xxx.youdomain.com as contents.</p>
<h3>1st trial</h3>
<p>It seems currently Nikola did not expected that CNAME as master's content so you have to checkout master manually, and add that CNAME file with the domain name you intend to use, and push into github by youself. * Reminding * the CNAME file created in src branch won't work since nikola github_deploy would ignore and won't copy CNAME into master branch. So if you don't do it manally the auto deploy would be over written again &amp; again even through you settle down the domain name in setting page of github repo or added in "src" branch. </p>
<h3>2nd trial</h3>
<p>It seems 1st trial works, but after new post build &amp; aut deploymetn by nikola, CNAME disappeared again :(
Then, fould <a href="http://louistiao.me/posts/configuring-the-namecheap-dns-for-your-nikola-site-on-github-pages/">this trick</a>, just copy CNAME into files folder in src branch.</p>
<h3>One more thing</h3>
<p>BTW, the even .gitignore need to double check also in master branch, all these branches would share this simple config file...</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jupyter-extension-jupyter-lab-config/" class="u-url">Jupyter Extension &amp; Jupyter Lab Config</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/jupyter-extension-jupyter-lab-config/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-17T22:33:21+08:00" itemprop="datePublished" title="2018-10-17 22:33">2018-10-17 22:33</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<h2>Jupyter</h2>
<h3>Enabled extension</h3>
<p>First three are used to enable the manager</p>
<h4>Nbextensions dashboard tab</h4>
<h4>Nbextensions edit menu item</h4>
<h4>contrib_nbextensions_help_item</h4>
<p>Below</p>
<h4>nbdime</h4>
<h4>Table of Contents(2)</h4>
<h4>Zenmode</h4>
<h4>Comment/Uncomment Hotkey</h4>
<h4>Snippets Menu</h4>
<h4>Split Cell Menu</h4>
<h4>Equation Auto Numbering</h4>
<h4>Variable Inspector</h4>
<h4>jupyter-js-widgets/extension</h4>
<h4>Python markdown</h4>
<h4>Live Markdown Preview</h4>
<h4>RICE</h4>
<h4>Hide input</h4>
<h4>Latex related (TBC)</h4>
<h3>Other Configs</h3>
<h2>Jupyter Lab</h2>
<h3>Enabled extension</h3>
<h4>jupyterlab-manager</h4>
<h4>latex</h4>
<h4>statusbar</h4>
<h4>toc</h4>
<h4>nbdime-jupyterlab</h4>
<h3>Other Configs</h3>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jupyter-halt-in-14-resolving-packages-when-installation-new-lab-extension/" class="u-url">jupyter halt in "[1/4] 🔍  Resolving packages..." when installation new lab extension</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/jupyter-halt-in-14-resolving-packages-when-installation-new-lab-extension/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-16T22:12:49+08:00" itemprop="datePublished" title="2018-10-16 22:12">2018-10-16 22:12</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <p>In the end, it's the node 10 compatibility issue with yarn 1.6.0 in jupyterlab
<a href="https://medium.com/@mahasakpijittum/downgrade-node-9-in-macos-18a3a55d5436">Downgrade into Node 9 in Mac</a> would resolve this...</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/test-nicola-with-markdown/" class="u-url">test nicola with markdown</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/test-nicola-with-markdown/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-14T00:07:27+08:00" itemprop="datePublished" title="2018-10-14 00:07">2018-10-14 00:07</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<h2>Ch1</h2>
<p>Probably all of you learn Flask studies via <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">The Flask Mega-Tutorial</a>. Even though I believe it's typical that starting a tutorial for beginners to start learn by standlone env, a Paas version would be suiable for beginers who are aiming for using Paas as Infrustruction as Paas is "next big thing" and it's popular all over the word even in China. That's enough talk, let's get the work done.</p>
<p>List of tutorials:</p>
<ol>
<li><a href="posts/test-nicola-with-markdown/">getting started and basic configurations in SAE</a></li>
<li>[]</li>
</ol>
<h2>SAE Basic Configuration</h2>
<p>Even though sae team claimed that flask only support 0.7 or some other version, I tried latest 0.10.1 in config file it works fine so far.</p>
<h3>SVN</h3>
<p>Create first version and you would have a init version. detailed useage you could refer <a href="http://sae.sina.com.cn/?m=devcenter&amp;catId=211">SVN Doc for SAE</a>.
After checkout, you would have a basic folder name 1 which could be used as a repo for your useage. </p>
<h3>Initialize the MySQL</h3>
<p>As sooner or later we would adopt MySQL, so we need intiallize it from the control panel.</p>
<h3>Local env (optional)</h3>
<p>Please refer to <a href="http://python.sinaapp.com/doc/index.html">SAE python user guide</a> for more details </p>
<h2>"Hello World" from Flask in SAE</h2>
<h3>application folder structure</h3>
<p>A recommandated project structure would be like this for now:</p>
<pre class="code literal-block"><span></span>1/
    config.yaml
    index.wsgi
    main.py
    app/
        views.py
        __init__.py
        static/
    tmp/
</pre>


<h3>flask modification in SAE</h3>
<p>index.wsgi would be frontgate for all request, need a instance to hanle http requests:</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">sae</span>

<span class="kn">from</span> <span class="nn">main</span> <span class="kn">import</span> <span class="n">app</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">sae</span><span class="o">.</span><span class="n">create_wsgi_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre>


<p>main.py would be like this: </p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">MySQLdb</span>

<span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>

<span class="kn">from</span> <span class="nn">sae.const</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MYSQL_HOST</span><span class="p">,</span> <span class="n">MYSQL_HOST_S</span><span class="p">,</span>
    <span class="n">MYSQL_PORT</span><span class="p">,</span> <span class="n">MYSQL_USER</span><span class="p">,</span> <span class="n">MYSQL_PASS</span><span class="p">,</span> <span class="n">MYSQL_DB</span>
<span class="p">)</span>

<span class="nd">@app.before_request</span>
<span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
    <span class="n">g</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">MYSQL_HOST</span><span class="p">,</span> <span class="n">MYSQL_USER</span><span class="p">,</span> <span class="n">MYSQL_PASS</span><span class="p">,</span>
                            <span class="n">MYSQL_DB</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">MYSQL_PORT</span><span class="p">))</span>

<span class="nd">@app.teardown_request</span>
<span class="k">def</span> <span class="nf">teardown_request</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">'db'</span><span class="p">):</span> <span class="n">g</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>


<h2>Ready to go</h2>
<p>SVN update and visit your application ID, or here to see what is <a href="http://1.flasktutorial.sinaapp.com/">expected</a>.</p>
<h2>Ch2</h2>
<p>Probably all of you learn Flask studies via <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">The Flask Mega-Tutorial</a>. Even though I believe it's typical that starting a tutorial for beginners to start learn by standlone env, a Paas version would be suiable for beginers who are aiming for using Paas as Infrustruction as Paas is "next big thing" and it's popular all over the word even in China. That's enough talk, let's get the work done.</p>
<p>List of tutorials:</p>
<ol>
<li><a href="posts/test-nicola-with-markdown/">getting started and basic configurations in SAE</a></li>
<li>[template]</li>
</ol>
<h2>Recap</h2>
<p>What we already have now is:</p>
<h2>Why we need template?</h2>
<h2>"Hello World" from Flask in SAE</h2>
<h3>First impression of template engine in Flask</h3>
<h4>add index template</h4>
<p>create a templates folder in app, the content is </p>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{title}} - microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello, {{user.nickname}}!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>


<h4>modify view to render from template</h4>
<p>view will change into:</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/index'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'nickname'</span><span class="p">:</span> <span class="s1">'Miguel'</span> <span class="p">}</span> <span class="c1"># fake user</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">"index.html"</span><span class="p">,</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Home'</span><span class="p">,</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="p">)</span>
</pre>


<p>Then you will find you pass the user name into the template. Jinja2 take care of ...</p>
<h3>Higher level templated skills</h3>
<p>Let move on for more details</p>
<h4>Control</h4>
<p><em>The Jinja2 templates also support control statements, given inside {%...%} blocks</em>.
update index template like this:</p>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    {% if title %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{title}} - microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% else %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Welcome to microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% endif %}
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello, {{user.nickname}}!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>


<p>Then, feel free to remove the <code>title</code> argue in view.py, you will find that logic in index.html will handle missing title situation.</p>
<h4>Loop</h4>
<p>First of all, you need provide contents(like <code>posts</code> as argue here) in view to show in templates. update <code>view.py</code> as the following:</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/index'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'nickname'</span><span class="p">:</span> <span class="s2">"SAE User"</span><span class="p">}</span> <span class="c1">#fake</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="p">[</span> <span class="c1"># fake array of posts</span>
        <span class="p">{</span> 
            <span class="s1">'author'</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'nickname'</span><span class="p">:</span> <span class="s1">'John'</span> <span class="p">},</span> 
            <span class="s1">'body'</span><span class="p">:</span> <span class="s1">'Beautiful day in Portland!'</span> 
        <span class="p">},</span>
        <span class="p">{</span> 
            <span class="s1">'author'</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'nickname'</span><span class="p">:</span> <span class="s1">'Susan'</span> <span class="p">},</span> 
            <span class="s1">'body'</span><span class="p">:</span> <span class="s1">'The Avengers movie was so cool!'</span> 
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">"index.html"</span><span class="p">,</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Home'</span><span class="p">,</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="p">,</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">posts</span><span class="p">)</span>
</pre>


<p>Then, let us take a look at how <code>for</code> loop works in <code>index.html</code>jinja2:</p>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    {% if title %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{title}} - microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% else %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% endif %}
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hi, {{user.nickname}}!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    {% for post in posts %}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{post.author.nickname}} says: <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>{{post.body}}<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endfor %}
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>


<h4>Tempalte Inheritance</h4>
<p>I could imagine how boring it is to repeat <code>head</code> stuff in htmls everytime when you create tempaltes, while thanks to inheritance of Jinja2, we could make our life easier by creating <code>base.html</code>, in this file we store all the repeating stuff for other siblings of our apps.</p>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    {% if title %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{title}} - microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% else %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% endif %}
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Microblog: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/index"</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    {% block content %}{% endblock %}
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>


<p>Then, other templates could reuse the generic stuff and do it own specific logic, like <code>index.html</code>:</p>
<pre class="code literal-block"><span></span>{% extends "base.html" %}
{% block content %}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hi, {{user.nickname}}!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{% for post in posts %}
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{post.author.nickname}} says: <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>{{post.body}}<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endfor %}
{% endblock %}
</pre>


<h2>Ready to go</h2>
<p>SVN update and visit your application ID in this version to enjoy what you've done already!
You could always refer <a href="http://2.flasktutorial.sinaapp.com/">here</a> to see what is expected.</p>
<h2>Ch3</h2>
<p>Probably all of you learn Flask studies via <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">The Flask Mega-Tutorial</a>. Even though I believe it's typical that starting a tutorial for beginners to start learn by standlone env, a Paas version would be suiable for beginers who are aiming for using Paas as Infrustruction as Paas is "next big thing" and it's popular all over the word even in China. That's enough talk, let's get the work done.</p>
<p>List of tutorials:</p>
<ol>
<li><a href="posts/test-nicola-with-markdown/">getting started and basic configurations in SAE</a></li>
<li>[template]</li>
<li>[Webform]</li>
</ol>
<h2>Recap</h2>
<p>What we already have now is seting up a basic Flask in SAE, and using the template engine in flask. While, web form is always one of the most important way to interact with users. What are we waiting for?</p>
<h2>WTF in Flask</h2>
<h3>about WTF in Flask</h3>
<p>In Flask WTF is most widely used form extension for form handling. more details you could get from :</p>
<ul>
<li><a href="http://wtforms.readthedocs.org/en/latest/">WTForm</a></li>
<li><a href="http://wtforms.readthedocs.org/en/latest/crash_course.html">WTForm Course</a></li>
<li><a href="https://flask-wtf.readthedocs.org/en/latest/">flask-wtf</a></li>
</ul>
<h3>config external packages in SAE</h3>
<p>There are several ways to install the packages in SAE:</p>
<ul>
<li>put in the version folder, import them directly</li>
<li>use remote API install related packages</li>
<li>use virtualenv, then use SAE remote API to install related packages</li>
</ul>
<p>As there are so many external packages to be installed in SAE, so we preferred 2 or 3 solution in this case. details refer to <a href="https://windrocblog.sinaapp.com/?p=935">link</a> or <a href="http://cloudbbs.org/forum.php?mod=viewthread&amp;tid=12860">link2</a>, or <a href="http://python.sinaapp.com/doc/tools.html#saecloud">offical doc</a>.</p>
<p>Anyway, after you installed the nessary package, in our case flask-wtf, you could modify the <code>index.wsgi</code> like this:</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="c1"># 两者取其一</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">'site-packages'</span><span class="p">))</span> <span class="c1">#if you do not zip the packages</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">'site-packages.zip'</span><span class="p">))</span> <span class="c1"># preferred for zipped packages</span>
</pre>


<p>Then, you could import the packages in your project.</p>
<h3>Config flask with the WTF extention</h3>
<p>Many extensions require some amount of configuration, fow now we could config our web app with <code>config.py</code> in version 3.</p>
<pre class="code literal-block"><span></span><span class="n">CSRF_ENABLED</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">'you-will-never-guess'</span>
</pre>


<p>This is accuary required by WTF, <code>CSRF_ENABLED</code> activates the <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a> prevention. In most cases you want to have this option enabled as it makes your app more secure.</p>
<p>And <code>SECRET_KEY</code> setting is noly needed when <code>CSRF</code> is enable, and is used to create a cryptographic token that is used to validate a form. WHen you write your own apps, please make sure to set the key into something others nerver to guess.</p>
<h3>load config in your flask app</h3>
<p>Well, this config file need to imported by our app to use it. Modify the file <code>app/__init__.py</code> as the following:</p>
<pre class="code literal-block"><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">'config'</span><span class="p">)</span>
</pre>


<h2>Start using form in Flask</h2>
<h3>First impression of forms in Flask</h3>
<p>Web froms are represented in Flask-WTF as objects, subclassed from class <em>Form</em>. A form subclass simply defines the fields of the form as class variables.</p>
<p>A login form will be created by using OpenID. We don't have to validate passwords.</p>
<p>The OpenID login only requires one string, called OpenID. We will also put a 'remember me' checkbox in the form.</p>
<p>The form would be like this <code>app/form.py</code>:</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">flask.ext.wtf</span> <span class="kn">import</span> <span class="n">Form</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">TextField</span><span class="p">,</span> <span class="n">BooleanField</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">Required</span>

<span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">openid</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">(</span><span class="s1">'openid'</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">Required</span><span class="p">()])</span>
    <span class="n">remember_me</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="s1">'remember_me'</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</pre>


<p>in the file, we imported the <em>Form</em> class, as twoo field classes we needed: <code>TextField</code> and <code>BooleanField</code>.
Onething to be highlighted here is the validator in openid field: <code>Required</code> validator simply checks that the field is not submitted empty. </p>
<h3>templates for Form</h3>
<p>create a templates named <code>login.html</code> for the login form as representative in <code>app/tempaltes</code>, the content is </p>
<pre class="code literal-block"><span></span><span class="c">&lt;!-- extend from base layout --&gt;</span>
{% extends "base.html" %}

{% block content %}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Sign In<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">name</span><span class="o">=</span><span class="s">"login"</span><span class="p">&gt;</span>
    {{form.hidden_tag()}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Please enter your OpenID:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{form.openid(size=80)}}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{form.remember_me}} Remember Me<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Sign In"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</pre>


<p>as previous templates intro, inherited from 'base.html' we creat the tempalte for form. While there are several differences which are worth to highlight:</p>
<p>The template expects a form object instantiated from the form class we just defined stored in a template argument named form. We will take care of sending this template argument to the template next, when we write the view function that renders this template.</p>
<p>The <code>form.hidden_tag()</code> template argument will get replaced with a hidden field that implements the CSRF prevention that we enabled in the configuration. This field needs to be in all your forms if you have CSRF enabled.</p>
<p>The actual fields of our form are also rendered by the form object, you just have to refer to a {{form.field_name}} template argument in the place where the field should be inserted. Some fields can take arguments. In our case, we are asking the form to generate our openid field with a width of 80 characters.</p>
<p>Since we have not defined the submit button in the form class we have to define it as a regular field. The submit field does not carry any data so it doesn't need to be defined in the form class.</p>
<h4>modify view to render from template</h4>
<p>The last step to complete a form is to code a view funtion to handle the specific URL requestion and pass throught the parameteres and render it in the tempaltes.</p>
<p>add contends for form in the <code>app/views.py</code> as following:</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">LoginForm</span>

<span class="c1">#index view function suppressed for brevity</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'login.html'</span><span class="p">,</span> 
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Sign In'</span><span class="p">,</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">)</span>
</pre>


<p>So, we imported the <code>LoginForm</code> Class in view, and sent it to the template.
Add in the route decorator, we defined the <code>methods</code> arguments. It tells the flask this view fuction accepts not only GET request, but also POST request..</p>
<p>Not you can see the form in your browser</p>
<h3>Receiving data from form submission</h3>
<p>How did you handle the data from form? Again, in the view func:</p>
<pre class="code literal-block"><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">'Login requested for OpenID="'</span> <span class="o">+</span> <span class="n">form</span><span class="o">.</span><span class="n">openid</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="s1">'", remember_me='</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">remember_me</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">'/index'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'login.html'</span><span class="p">,</span> 
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Sign In'</span><span class="p">,</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">)</span>
</pre>


<p>The <code>validate_on_submit</code> method does all the form processing work. When the form just being presented to the user, then it will return <code>False</code>, which means Flask will just render the template.</p>
<p>If <code>validate_on_submit</code> is called as part of a form submission request, then it will gather all data, run any validators attached to fields, and if everything is  all right and it will return <code>True</code>, indicating that the data is valid to proceed next step.</p>
<ul>
<li>if validatio pass through, two more steps are processing after that. <code>flash</code> function is a quick way to show a message on the next page presented to the user. By now, we just show the submitted data to user. of course, we need update the template to show these flash messages. This time we will update in the <code>app/templates/base.html</code> as these flashese would be used as a generic functionalities:</li>
</ul>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    {% if title %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{title}} - microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% else %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% endif %}
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Microblog: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/index"</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% for message in messages %}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ message }} <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>


<p>Jiajia <code>with</code> will xxxxxxxxxx. the other step is using <code>redirect</code> to tells the client web browser to navigate to a different page(index in this case).
noted that the flashed messages will display even if a view function ends in a redirect.</p>
<ul>
<li>if validation teturn <code>Flase</code>, we would see later how to show an error message when vlalidation fails.</li>
</ul>
<p>This is a great time to start the app and test how the form works. Make sure you try submitting the form with the openid field empty, to see how the Required validator halts the submit process.</p>
<h3>improve the field validation</h3>
<p>Currently, if validation fails, the page will not submit. While a hint to user which part is missing is helpful to imporvement the usibility. Luckily, Flask-WTF also makes this an easy task.</p>
<p>update <code>app/templates/login.html</code> template like this:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!-- extend base layout --&gt;</span>
{% extends "base.html" %}

{% block content %}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Sign In<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">name</span><span class="o">=</span><span class="s">"login"</span><span class="p">&gt;</span>
    {{form.hidden_tag()}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Please enter your OpenID:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{form.openid(size=80)}}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {% for error in form.errors.openid %}
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">"color: red;"</span><span class="p">&gt;</span>[{{error}}]<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        {% endfor %}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{form.remember_me}} Remember Me<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Sign In"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</pre>


<p>The only change we've made is to add a for loop that renders any messages added by the validators below the openid field. <em>As a general rule, any fields that have validators attached will have errors added under <code>form.errors.field_name</code></em>. In our case we use <code>form.errors.openid</code>. We display these messages in a red style to call the user's attention.</p>
<h3>Dealing with OpenID</h3>
<p>If you have an account with Google, you have an OpenID with them. Likewise with Yahoo, AOL, Flickr and many other providers.</p>
<p>While we need define which services are supported in our app, so you need update config file(file <code>config.py</code>) like this</p>
<pre class="code literal-block"><span></span><span class="n">CSRF_ENABLED</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">'you-will-never-guess'</span>

<span class="n">OPENID_PROVIDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Google'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'https://www.google.com/accounts/o8/id'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Yahoo'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'https://me.yahoo.com'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'AOL'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'http://openid.aol.com/&lt;username&gt;'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Flickr'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'http://www.flickr.com/&lt;username&gt;'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'MyOpenID'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'https://www.myopenid.com'</span> <span class="p">}]</span>
</pre>


<p>Then, let us take a look at how we need update view to handle OpenID:</p>
<pre class="code literal-block"><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">'Login requested for OpenID="'</span> <span class="o">+</span> <span class="n">form</span><span class="o">.</span><span class="n">openid</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="s1">'", remember_me='</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">remember_me</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">'/index'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'login.html'</span><span class="p">,</span> 
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Sign In'</span><span class="p">,</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">,</span>
        <span class="n">providers</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'OPENID_PROVIDERS'</span><span class="p">])</span>
</pre>


<p>It just pass through the 'OPENID_PROVIDERS' to tempate.</p>
<p>Now, some modicidations are needed to handle the pass-through <code>OPENID_OROVIDERS</code>, update the <code>app/templates/login.html</code>:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!-- extend base layout --&gt;</span>
{% extends "base.html" %}

{% block content %}
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span><span class="p">&gt;</span>
<span class="kd">function</span> <span class="nx">set_openid</span><span class="p">(</span><span class="nx">openid</span><span class="p">,</span> <span class="nx">pr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">u</span> <span class="o">=</span> <span class="nx">openid</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s1">'&lt;username&gt;'</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">u</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// openid requires username</span>
        <span class="nx">user</span> <span class="o">=</span> <span class="nx">prompt</span><span class="p">(</span><span class="s1">'Enter your '</span> <span class="o">+</span> <span class="nx">pr</span> <span class="o">+</span> <span class="s1">' username:'</span><span class="p">)</span>
        <span class="nx">openid</span> <span class="o">=</span> <span class="nx">openid</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">u</span><span class="p">)</span> <span class="o">+</span> <span class="nx">user</span>
    <span class="p">}</span>
    <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="s1">'login'</span><span class="p">];</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'openid'</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">openid</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Sign In<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">name</span><span class="o">=</span><span class="s">"login"</span><span class="p">&gt;</span>
    {{form.hidden_tag()}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Please enter your OpenID, or select one of the providers below:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{form.openid(size=80)}}
        {% for error in form.errors.openid %}
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">"color: red;"</span><span class="p">&gt;</span>[{{error}}]<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        {% endfor %}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        |{% for pr in providers %}
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"javascript:set_openid('{{pr.url}}', '{{pr.name}}');"</span><span class="p">&gt;</span>{{pr.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{form.remember_me}} Remember Me<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Sign In"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</pre>


<p>Some OpenIDs include the user's username, so for those we have to have a bit of javascript magic that prompts the user for its username and then composes the OpenID. When the user clicks on an OpenID provider link and (optionally) enters the username, the OpenID for that provider is inserted in the text field.</p>
<h2>Ready to go</h2>
<p>SVN update and visit your application ID in this version to enjoy what you've done already!
You could always refer <a href="http://3.flasktutorial.sinaapp.com/">here</a> to see what is expected.</p>
<p>For now we just finish basic progress regarding forms, there are lots of things to be fixed till we actually do something, such as database setup in next artical.</p>
<h2>Ch4</h2>
<p>Probably all of you learn Flask studies via <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">The Flask Mega-Tutorial</a>. Even though I believe it's typical that starting a tutorial for beginners to start learn by standlone env, a Paas version would be suiable for beginers who are aiming for using Paas as Infrustruction as Paas is "next big thing" and it's popular all over the word even in China. That's enough talk, let's get the work done.</p>
<p>List of tutorials:</p>
<ol>
<li><a href="posts/test-nicola-with-markdown/">getting started and basic configurations in SAE</a></li>
<li>[template]</li>
<li>[Webform]</li>
<li>[Database]</li>
</ol>
<h2>Recap</h2>
<p>What we already have now is seting up a basic Flask in SAE without anyn database configuration. And as you may already known, database is essential part for web developing and we will start config it in SAE on this artical.</p>
<h2>WTF in Flask</h2>
<h3>about db migration in SAE</h3>
<p>There are 3 ways for now I thouht out to migrate db in SAE
- Using local db, then update date into remote sae sever.
- <a href="http://wtforms.readthedocs.org/en/latest/crash_course.html">WTForm Course</a>
- <a href="https://flask-wtf.readthedocs.org/en/latest/">flask-wtf</a></p>
<h3>config external packages in SAE</h3>
<p>There are several ways to install the packages in SAE:</p>
<ul>
<li>put in the version folder, import them directly</li>
<li>use remote API install related packages</li>
<li>use virtualenv, then use SAE remote API to install related packages</li>
</ul>
<p>As there are so many external packages to be installed in SAE, so we preferred 2 or 3 solution in this case. details refer to <a href="https://windrocblog.sinaapp.com/?p=935">link</a> or <a href="http://cloudbbs.org/forum.php?mod=viewthread&amp;tid=12860">link2</a>, or <a href="http://python.sinaapp.com/doc/tools.html#saecloud">offical doc</a>.</p>
<p>Anyway, after you installed the nessary package, in our case flask-wtf, you could modify the <code>index.wsgi</code> like this:</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="c1">#sys.path.insert(0, os.path.join(root, 'site-packages')) #if you do not zip the packages</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">'site-packages.zip'</span><span class="p">))</span> <span class="c1"># preferred for zipped packages</span>
</pre>


<p>Then, you could import the packages in your project.</p>
<h3>Config flask with the WTF extention</h3>
<p>Many extensions require some amount of configuration, fow now we could config our web app with <code>config.py</code> in version 3.</p>
<pre class="code literal-block"><span></span><span class="n">CSRF_ENABLED</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">'you-will-never-guess'</span>
</pre>


<p>This is accuary required by WTF, <code>CSRF_ENABLED</code> activates the <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a> prevention. In most cases you want to have this option enabled as it makes your app more secure.</p>
<p>And <code>SECRET_KEY</code> setting is noly needed when <code>CSRF</code> is enable, and is used to create a cryptographic token that is used to validate a form. WHen you write your own apps, please make sure to set the key into something others nerver to guess.</p>
<h3>load config in your flask app</h3>
<p>Well, this config file need to imported by our app to use it. Modify the file <code>app/__init__.py</code> as the following:</p>
<pre class="code literal-block"><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">'config'</span><span class="p">)</span>
</pre>


<h2>Start using form in Flask</h2>
<h3>First impression of forms in Flask</h3>
<p>Web froms are represented in Flask-WTF as objects, subclassed from class <em>Form</em>. A form subclass simply defines the fields of the form as class variables.</p>
<p>A login form will be created by using OpenID. We don't have to validate passwords.</p>
<p>The OpenID login only requires one string, called OpenID. We will also put a 'remember me' checkbox in the form.</p>
<p>The form would be like this <code>app/form.py</code>:</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">flask.ext.wtf</span> <span class="kn">import</span> <span class="n">Form</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">TextField</span><span class="p">,</span> <span class="n">BooleanField</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">Required</span>

<span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">openid</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">(</span><span class="s1">'openid'</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">Required</span><span class="p">()])</span>
    <span class="n">remember_me</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="s1">'remember_me'</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</pre>


<p>in the file, we imported the <em>Form</em> class, as twoo field classes we needed: <code>TextField</code> and <code>BooleanField</code>.
Onething to be highlighted here is the validator in openid field: <code>Required</code> validator simply checks that the field is not submitted empty. </p>
<h3>templates for Form</h3>
<p>create a templates named <code>login.html</code> for the login form as representative in <code>app/tempaltes</code>, the content is </p>
<pre class="code literal-block"><span></span><span class="c">&lt;!-- extend from base layout --&gt;</span>
{% extends "base.html" %}

{% block content %}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Sign In<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">name</span><span class="o">=</span><span class="s">"login"</span><span class="p">&gt;</span>
    {{form.hidden_tag()}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Please enter your OpenID:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{form.openid(size=80)}}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{form.remember_me}} Remember Me<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Sign In"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</pre>


<p>as previous templates intro, inherited from 'base.html' we creat the tempalte for form. While there are several differences which are worth to highlight:</p>
<p>The template expects a form object instantiated from the form class we just defined stored in a template argument named form. We will take care of sending this template argument to the template next, when we write the view function that renders this template.</p>
<p>The <code>form.hidden_tag()</code> template argument will get replaced with a hidden field that implements the CSRF prevention that we enabled in the configuration. This field needs to be in all your forms if you have CSRF enabled.</p>
<p>The actual fields of our form are also rendered by the form object, you just have to refer to a {{form.field_name}} template argument in the place where the field should be inserted. Some fields can take arguments. In our case, we are asking the form to generate our openid field with a width of 80 characters.</p>
<p>Since we have not defined the submit button in the form class we have to define it as a regular field. The submit field does not carry any data so it doesn't need to be defined in the form class.</p>
<h4>modify view to render from template</h4>
<p>The last step to complete a form is to code a view funtion to handle the specific URL requestion and pass throught the parameteres and render it in the tempaltes.</p>
<p>add contends for form in the <code>app/views.py</code> as following:</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">LoginForm</span>

<span class="c1">#index view function suppressed for brevity</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'login.html'</span><span class="p">,</span> 
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Sign In'</span><span class="p">,</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">)</span>
</pre>


<p>So, we imported the <code>LoginForm</code> Class in view, and sent it to the template.
Add in the route decorator, we defined the <code>methods</code> arguments. It tells the flask this view fuction accepts not only GET request, but also POST request..</p>
<p>Not you can see the form in your browser</p>
<h3>Receiving data from form submission</h3>
<p>How did you handle the data from form? Again, in the view func:</p>
<pre class="code literal-block"><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">'Login requested for OpenID="'</span> <span class="o">+</span> <span class="n">form</span><span class="o">.</span><span class="n">openid</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="s1">'", remember_me='</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">remember_me</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">'/index'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'login.html'</span><span class="p">,</span> 
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Sign In'</span><span class="p">,</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">)</span>
</pre>


<p>The <code>validate_on_submit</code> method does all the form processing work. When the form just being presented to the user, then it will return <code>False</code>, which means Flask will just render the template.</p>
<p>If <code>validate_on_submit</code> is called as part of a form submission request, then it will gather all data, run any validators attached to fields, and if everything is  all right and it will return <code>True</code>, indicating that the data is valid to proceed next step.</p>
<ul>
<li>if validatio pass through, two more steps are processing after that. <code>flash</code> function is a quick way to show a message on the next page presented to the user. By now, we just show the submitted data to user. of course, we need update the template to show these flash messages. This time we will update in the <code>app/templates/base.html</code> as these flashese would be used as a generic functionalities:</li>
</ul>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    {% if title %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{title}} - microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% else %}
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>microblog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% endif %}
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Microblog: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/index"</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% for message in messages %}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ message }} <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>


<p>Jiajia <code>with</code> will xxxxxxxxxx. the other step is using <code>redirect</code> to tells the client web browser to navigate to a different page(index in this case).
noted that the flashed messages will display even if a view function ends in a redirect.</p>
<ul>
<li>if validation teturn <code>Flase</code>, we would see later how to show an error message when vlalidation fails.</li>
</ul>
<p>This is a great time to start the app and test how the form works. Make sure you try submitting the form with the openid field empty, to see how the Required validator halts the submit process.</p>
<h3>improve the field validation</h3>
<p>Currently, if validation fails, the page will not submit. While a hint to user which part is missing is helpful to imporvement the usibility. Luckily, Flask-WTF also makes this an easy task.</p>
<p>update <code>app/templates/login.html</code> template like this:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!-- extend base layout --&gt;</span>
{% extends "base.html" %}

{% block content %}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Sign In<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">name</span><span class="o">=</span><span class="s">"login"</span><span class="p">&gt;</span>
    {{form.hidden_tag()}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Please enter your OpenID:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{form.openid(size=80)}}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {% for error in form.errors.openid %}
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">"color: red;"</span><span class="p">&gt;</span>[{{error}}]<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        {% endfor %}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{form.remember_me}} Remember Me<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Sign In"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</pre>


<p>The only change we've made is to add a for loop that renders any messages added by the validators below the openid field. <em>As a general rule, any fields that have validators attached will have errors added under <code>form.errors.field_name</code></em>. In our case we use <code>form.errors.openid</code>. We display these messages in a red style to call the user's attention.</p>
<h3>Dealing with OpenID</h3>
<p>If you have an account with Google, you have an OpenID with them. Likewise with Yahoo, AOL, Flickr and many other providers.</p>
<p>While we need define which services are supported in our app, so you need update config file(file <code>config.py</code>) like this</p>
<pre class="code literal-block"><span></span><span class="n">CSRF_ENABLED</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">'you-will-never-guess'</span>

<span class="n">OPENID_PROVIDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Google'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'https://www.google.com/accounts/o8/id'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Yahoo'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'https://me.yahoo.com'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'AOL'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'http://openid.aol.com/&lt;username&gt;'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Flickr'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'http://www.flickr.com/&lt;username&gt;'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'MyOpenID'</span><span class="p">,</span> <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'https://www.myopenid.com'</span> <span class="p">}]</span>
</pre>


<p>Then, let us take a look at how we need update view to handle OpenID:</p>
<pre class="code literal-block"><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">'Login requested for OpenID="'</span> <span class="o">+</span> <span class="n">form</span><span class="o">.</span><span class="n">openid</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="s1">'", remember_me='</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">remember_me</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">'/index'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'login.html'</span><span class="p">,</span> 
        <span class="n">title</span> <span class="o">=</span> <span class="s1">'Sign In'</span><span class="p">,</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">,</span>
        <span class="n">providers</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'OPENID_PROVIDERS'</span><span class="p">])</span>
</pre>


<p>It just pass through the 'OPENID_PROVIDERS' to tempate.</p>
<p>Now, some modicidations are needed to handle the pass-through <code>OPENID_OROVIDERS</code>, update the <code>app/templates/login.html</code>:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!-- extend base layout --&gt;</span>
{% extends "base.html" %}

{% block content %}
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span><span class="p">&gt;</span>
<span class="kd">function</span> <span class="nx">set_openid</span><span class="p">(</span><span class="nx">openid</span><span class="p">,</span> <span class="nx">pr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">u</span> <span class="o">=</span> <span class="nx">openid</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s1">'&lt;username&gt;'</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">u</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// openid requires username</span>
        <span class="nx">user</span> <span class="o">=</span> <span class="nx">prompt</span><span class="p">(</span><span class="s1">'Enter your '</span> <span class="o">+</span> <span class="nx">pr</span> <span class="o">+</span> <span class="s1">' username:'</span><span class="p">)</span>
        <span class="nx">openid</span> <span class="o">=</span> <span class="nx">openid</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">u</span><span class="p">)</span> <span class="o">+</span> <span class="nx">user</span>
    <span class="p">}</span>
    <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="s1">'login'</span><span class="p">];</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'openid'</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">openid</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Sign In<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">""</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">name</span><span class="o">=</span><span class="s">"login"</span><span class="p">&gt;</span>
    {{form.hidden_tag()}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Please enter your OpenID, or select one of the providers below:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{form.openid(size=80)}}
        {% for error in form.errors.openid %}
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">"color: red;"</span><span class="p">&gt;</span>[{{error}}]<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        {% endfor %}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        |{% for pr in providers %}
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"javascript:set_openid('{{pr.url}}', '{{pr.name}}');"</span><span class="p">&gt;</span>{{pr.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{form.remember_me}} Remember Me<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Sign In"</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</pre>


<p>Some OpenIDs include the user's username, so for those we have to have a bit of javascript magic that prompts the user for its username and then composes the OpenID. When the user clicks on an OpenID provider link and (optionally) enters the username, the OpenID for that provider is inserted in the text field.</p>
<h2>Ready to go</h2>
<p>SVN update and visit your application ID in this version to enjoy what you've done already!
You could always refer <a href="http://3.flasktutorial.sinaapp.com/">here</a> to see what is expected.</p>
<p>For now we just finish basic progress regarding forms, there are lots of things to be fixed till we actually do something, such as database setup in next artical.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/test-nicola/" class="u-url">Test Nicola</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/test-nicola/" rel="bookmark">
            <time class="published dt-published" datetime="2018-10-13T23:47:38+08:00" itemprop="datePublished" title="2018-10-13 23:47">2018-10-13 23:47</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <p>Write your post here.</p>
    </div>
    </article><article class="h-entry post-" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2009/12/27/5187html/" class="u-url">刚做好的pizza</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonny Hou
            </span></p>
            <p class="dateline">
            <a href="posts/2009/12/27/5187html/" rel="bookmark">
            <time class="published dt-published" datetime="2009-12-27T06:24:57+08:00" itemprop="datePublished" title="2009-12-27 06:24">2009-12-27 06:24</time></a>
            </p>
                <p class="commentline">        

        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p></p>
<p><img style="padding:0px 10px 10px 10px;" title="image121792455.jpg" src="posts/2009/12/27/media/agJlaXIMCxIFTWVkaWEYwigM" alt="image121792455.jpg" width="280" align="left">蜗居期间，用新的烤箱做的。。。。</p>
<p>还做了比外边任何地方都好吃的烤地瓜</p>
<p>还有绝妙的烤鱼。</p>
<p>终于知道，美味的最高境界就是：</p>
<p>自己动手，创造适合自己口味的美食！！</p>
<p>太惬意了～</p>
<p>PS：用iPhone照的照片，将就留个纪念吧，哈哈。另外吧GAE搭起来把Blogger备份了过来，希望这次不会被封。。。</p>
<p>Mobile Blogging from <a class="iblogger-location" href="http://maps.google.com/maps?ll=39.9644,116.3999">here</a>.  <span style="font-size: 10px;">[Posted with from my iPhone]</span></p>
<div class="iblogger-footer"></div>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-10.html" rel="next">以前的文章</a>
            </li>
        </ul></nav>
</div>
    </div>
    <!--End of body content-->
</div>
<div class="footerbox">
    Contents © 2018         <a href="mailto:monkeyxite@gmail.com">Jonny Hou</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
    
</div>
            <script src="../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("zh-cn");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-238788-7"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'UA-238788-7');
            </script>
</body>
</html>
